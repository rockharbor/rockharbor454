!function(o){o.isScrollToFixed=function(i){return!!o(i).data("ScrollToFixed")},o.ScrollToFixed=function(i,e){function t(){S.trigger("preUnfixed.ScrollToFixed"),p(),S.trigger("unfixed.ScrollToFixed"),z=-1,C=S.offset().top,U=S.offset().left,F.options.offsets&&(U+=S.offset().left-S.position().left),-1==y&&(y=U),m=S.css("position"),T=!0,-1!=F.options.bottom&&(S.trigger("preFixed.ScrollToFixed"),d(),S.trigger("fixed.ScrollToFixed"))}function n(){var o=F.options.limit;return o?"function"==typeof o?o.apply(S):o:0}function s(){return"fixed"===m}function l(){return"absolute"===m}function r(){return!(s()||l())}function d(){if(!s()){var o=S[0].getBoundingClientRect();A.css({display:S.css("display"),width:o.width,height:o.height,float:S.css("float")}),cssOptions={"z-index":F.options.zIndex,position:"fixed",top:-1==F.options.bottom?f():"",bottom:-1==F.options.bottom?"":F.options.bottom,"margin-left":"0px"},F.options.dontSetWidth||(cssOptions.width=S.css("width")),S.css(cssOptions),S.addClass(F.options.baseClassName),F.options.className&&S.addClass(F.options.className),m="fixed"}}function c(){var o=n(),i=U;F.options.removeOffsets&&(i="",o-=C),cssOptions={position:"absolute",top:o,left:i,"margin-left":"0px",bottom:""},F.options.dontSetWidth||(cssOptions.width=S.css("width")),S.css(cssOptions),m="absolute"}function p(){r()||(z=-1,A.css("display","none"),S.css({"z-index":v,width:"",position:b,left:"",top:w,"margin-left":""}),S.removeClass("scroll-to-fixed-fixed"),F.options.className&&S.removeClass(F.options.className),m=null)}function x(o){o!=z&&(S.css("left",U-o),z=o)}function f(){var o=F.options.marginTop;return o?"function"==typeof o?o.apply(S):o:0}function u(){if(o.isScrollToFixed(S)&&!S.is(":hidden")){var i=T,e=r();T?r()&&(C=S.offset().top,U=S.offset().left):t();var u=o(window).scrollLeft(),m=o(window).scrollTop(),h=n();F.options.minWidth&&o(window).width()<F.options.minWidth?r()&&i||(g(),S.trigger("preUnfixed.ScrollToFixed"),p(),S.trigger("unfixed.ScrollToFixed")):F.options.maxWidth&&o(window).width()>F.options.maxWidth?r()&&i||(g(),S.trigger("preUnfixed.ScrollToFixed"),p(),S.trigger("unfixed.ScrollToFixed")):-1==F.options.bottom?h>0&&m>=h-f()?e||l()&&i||(g(),S.trigger("preAbsolute.ScrollToFixed"),c(),S.trigger("unfixed.ScrollToFixed")):m>=C-f()?(s()&&i||(g(),S.trigger("preFixed.ScrollToFixed"),d(),z=-1,S.trigger("fixed.ScrollToFixed")),x(u)):r()&&i||(g(),S.trigger("preUnfixed.ScrollToFixed"),p(),S.trigger("unfixed.ScrollToFixed")):h>0?m+o(window).height()-S.outerHeight(!0)>=h-(f()||-a())?s()&&(g(),S.trigger("preUnfixed.ScrollToFixed"),"absolute"===b?c():p(),S.trigger("unfixed.ScrollToFixed")):(s()||(g(),S.trigger("preFixed.ScrollToFixed"),d()),x(u),S.trigger("fixed.ScrollToFixed")):x(u)}}function a(){return F.options.bottom?F.options.bottom:0}function g(){var o=S.css("position");"absolute"==o?S.trigger("postAbsolute.ScrollToFixed"):"fixed"==o?S.trigger("postFixed.ScrollToFixed"):S.trigger("postUnfixed.ScrollToFixed")}var F=this;F.$el=o(i),F.el=i,F.$el.data("ScrollToFixed",F);var T=!1,S=F.$el,m,b,h,w,v,C=0,U=0,y=-1,z=-1,A=null,O,N,W=function(o){S.is(":visible")?(T=!1,u()):p()},B=function(o){window.requestAnimationFrame?requestAnimationFrame(u):u()},D=function(){var o=document.body;if(document.createElement&&o&&o.appendChild&&o.removeChild){var i=document.createElement("div");if(!i.getBoundingClientRect)return null;i.innerHTML="x",i.style.cssText="position:fixed;top:100px;",o.appendChild(i);var e=o.style.height,t=o.scrollTop;o.style.height="3000px",o.scrollTop=500;var n=i.getBoundingClientRect().top;o.style.height=e;var s=100===n;return o.removeChild(i),o.scrollTop=t,s}return null},I=function(o){o=o||window.event,o.preventDefault&&o.preventDefault(),o.returnValue=!1};F.init=function(){F.options=o.extend({},o.ScrollToFixed.defaultOptions,e),v=S.css("z-index"),F.$el.css("z-index",F.options.zIndex),A=o("<div />"),m=S.css("position"),b=S.css("position"),h=S.css("float"),w=S.css("top"),r()&&F.$el.after(A),o(window).bind("resize.ScrollToFixed",W),o(window).bind("scroll.ScrollToFixed",B),"ontouchmove"in window&&o(window).bind("touchmove.ScrollToFixed",u),F.options.preFixed&&S.bind("preFixed.ScrollToFixed",F.options.preFixed),F.options.postFixed&&S.bind("postFixed.ScrollToFixed",F.options.postFixed),F.options.preUnfixed&&S.bind("preUnfixed.ScrollToFixed",F.options.preUnfixed),F.options.postUnfixed&&S.bind("postUnfixed.ScrollToFixed",F.options.postUnfixed),F.options.preAbsolute&&S.bind("preAbsolute.ScrollToFixed",F.options.preAbsolute),F.options.postAbsolute&&S.bind("postAbsolute.ScrollToFixed",F.options.postAbsolute),F.options.fixed&&S.bind("fixed.ScrollToFixed",F.options.fixed),F.options.unfixed&&S.bind("unfixed.ScrollToFixed",F.options.unfixed),F.options.spacerClass&&A.addClass(F.options.spacerClass),S.bind("resize.ScrollToFixed",function(){A.height(S.height())}),S.bind("scroll.ScrollToFixed",function(){S.trigger("preUnfixed.ScrollToFixed"),p(),S.trigger("unfixed.ScrollToFixed"),u()}),S.bind("detach.ScrollToFixed",function(i){I(i),S.trigger("preUnfixed.ScrollToFixed"),p(),S.trigger("unfixed.ScrollToFixed"),o(window).unbind("resize.ScrollToFixed",W),o(window).unbind("scroll.ScrollToFixed",B),S.unbind(".ScrollToFixed"),A.remove(),F.$el.removeData("ScrollToFixed")}),W()},F.init()},o.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3,baseClassName:"scroll-to-fixed-fixed"},o.fn.scrollToFixed=function(i){return this.each(function(){new o.ScrollToFixed(this,i)})}}(jQuery);